!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb=[].slice,cb={}.hasOwnProperty,db=function(a,b){function c(){this.constructor=a}for(var d in b)cb.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},eb=function(a,b){return function(){return a.apply(b,arguments)}};a={},a.fromBinder=function(b,c){return null==c&&(c=Z.id),new i(w("fromBinder",b,c),function(d){var e;return e=b(function(){var b,f,g,i,j,k;for(b=1<=arguments.length?bb.call(arguments,0):[],i=c.apply(null,b),B(i)&&Z.last(i)instanceof h||(i=[i]),g=a.more,j=0,k=i.length;k>j;j++)if(f=i[j],g=d(f=S(f)),g===a.noMore||f.isEnd())return null!=e?e():a.scheduler.setTimeout(function(){return e()},0),g;return g})})},a.$={asEventStream:function(b,c,d){var e,f=this;return D(c)&&(e=[c,null],d=e[0],c=e[1]),X("asEventStream",this,b,a.fromBinder(function(a){return f.on(b,c,a),function(){return f.off(b,c,a)}},d))}},null!=($="undefined"!=typeof jQuery&&null!==jQuery?jQuery:"undefined"!=typeof Zepto&&null!==Zepto?Zepto:null)&&($.fn.asEventStream=a.$.asEventStream),a.fromEventTarget=function(b,c,d){var e,f,g,h,i,j;return e=null!=(g=b.addEventListener)?g:null!=(h=b.addListener)?h:b.bind,f=null!=(i=b.removeEventListener)?i:null!=(j=b.removeListener)?j:b.unbind,X("fromEventTarget",b,c,a.fromBinder(function(a){return e.call(b,c,a),function(){return f.call(b,c,a)}},d))},a.fromPromise=function(b,c){return X("fromPromise",b,a.fromBinder(function(a){return b.then(a,function(b){return a(new g(b))}),function(){return c?"function"==typeof b.abort?b.abort():void 0:void 0}},function(a){return[a,x()]}))},a.noMore=["<no-more>"],a.more=["<more>"],a.later=function(b,c){return X("later",b,c,a.sequentially(b,[c]))},a.sequentially=function(b,c){var d;return d=0,X("sequentially",b,c,a.fromPoll(b,function(){var a;return a=c[d++],d<c.length?a:d===c.length?[a,x()]:x()}))},a.repeatedly=function(b,c){var d;return d=0,a.fromPoll(b,function(){return c[d++%c.length]})},a.spy=function(a){return Q.push(a)},Q=[],O=function(a){if(Q.length&&!O.running)try{return O.running=!0,Z.each(Q,function(b,c){return c(a)})}finally{delete O.running}},Y=function(a){return function(){var b,c,d,e;return d=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],"object"==typeof d&&b.length&&(c=d,e=b[0],d=function(){return c[e].apply(c,arguments)},b=b.slice(1)),a.apply(null,[d].concat(bb.call(b)))}},G=function(b,c){return Y(function(){var d,e,f;return e=arguments[0],d=2<=arguments.length?bb.call(arguments,1):[],f=N(c,[function(a,b){return e.apply(null,bb.call(a).concat([b]))}]),X.apply(null,[b,e].concat(bb.call(d),[a.combineAsArray(d).flatMap(f)]))})},a.fromCallback=G("fromCallback",function(){var b,c;return c=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],a.fromBinder(function(a){return H(c,b)(a),M},function(a){return[a,x()]})}),a.fromNodeCallback=G("fromNodeCallback",function(){var b,c;return c=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],a.fromBinder(function(a){return H(c,b)(a),M},function(a,b){return a?[new g(a),x()]:[b,x()]})}),a.fromPoll=function(b,c){return a.fromBinder(function(c){var d;return d=a.scheduler.setInterval(c,b),function(){return a.scheduler.clearInterval(d)}},c,w("fromPoll",b,c))},a.interval=function(b,c){return null==c&&(c={}),X("interval",b,c,a.fromPoll(b,function(){return L(c)}))},a.constant=function(a){return new n(w("constant",a),P([a],A),!0)},a.never=function(){return X("never",a.fromArray([]))},a.once=function(b){return X("once",b,a.fromArray([b]))},a.fromArray=function(a){return new i(w("fromArray",a),P(a,S))},P=function(a,b){return function(c){var d,e,f;for(e=0,f=a.length;f>e;e++)d=a[e],c(b(d));return c(x()),M}},a.mergeAll=function(){var b;return b=1<=arguments.length?bb.call(arguments,0):[],B(b[0])&&(b=b[0]),Z.fold(b,a.never(),function(a,b){return a.merge(b)})},a.zipAsArray=function(){var b;return b=1<=arguments.length?bb.call(arguments,0):[],B(b[0])&&(b=b[0]),a.zipWith(b,function(){var a;return a=1<=arguments.length?bb.call(arguments,0):[]})},a.zipWith=function(){var b,c,d;return b=arguments[0],c=2<=arguments.length?bb.call(arguments,1):[],D(b)||(d=[b,c[0]],c=d[0],b=d[1]),a.when(c,b,w("zipWith",b,c))},a.combineAsArray=function(){var b,c,d,e,f,g,h;for(f=1<=arguments.length?bb.call(arguments,0):[],1===f.length&&B(f[0])&&(f=f[0]),b=g=0,h=f.length;h>g;b=++g)e=f[b],E(e)||(f[b]=a.constant(e));return f.length?(d=function(){var a,b,d;for(d=[],a=0,b=f.length;b>a;a++)c=f[a],d.push(new r(c,!0,!1,c.subscribeInternal));return d}(),X("combineAsArray",f,a.when(d,function(){var a;return a=1<=arguments.length?bb.call(arguments,0):[]},w("combineAsArray",f)).toProperty())):a.constant([])},a.onValues=function(){var b,c,d;return c=2<=arguments.length?bb.call(arguments,0,d=arguments.length-1):(d=0,[]),b=arguments[d++],a.combineAsArray(c).onValues(b)},a.combineWith=function(){var b,c;return b=arguments[0],c=2<=arguments.length?bb.call(arguments,1):[],a.combineAsArray(c).map(function(a){return b.apply(null,a)})},a.combineTemplate=function(b){var c,d,e,f,g,h,i,j,k,l;return i=[],l=[],h=function(a){return a[a.length-1]},k=function(a,b,c){return h(a)[b]=c},c=function(a,b){return function(c,d){return k(c,a,d[b])}},g=function(a,b){return function(c){return k(c,a,b)}},j=function(a){return B(a)?[]:{}},e=function(a,b){var d,e;return E(b)?(l.push(b),i.push(c(a,l.length-1))):b===Object(b)&&"function"!=typeof b?(e=function(a){return function(c){var d;return d=j(b),k(c,a,d),c.push(d)}},d=function(a){return a.pop()},i.push(e(a)),f(b),i.push(d)):i.push(g(a,b))},f=function(a){return Z.each(a,e)},f(b),d=function(a){var c,d,e,f,g;for(e=j(b),c=[e],f=0,g=i.length;g>f;f++)d=i[f],d(c,a);return e},a.combineAsArray(l).map(d)},h=function(){function a(){}return a.prototype.isEvent=function(){return!0},a.prototype.isEnd=function(){return!1},a.prototype.isInitial=function(){return!1},a.prototype.isNext=function(){return!1},a.prototype.isError=function(){return!1},a.prototype.hasValue=function(){return!1},a.prototype.filter=function(){return!0},a}(),k=function(a){function b(a){this.value=D(a)?Z.cached(a):Z.always(a)}return db(b,a),b.prototype.isNext=function(){return!0},b.prototype.hasValue=function(){return!0},b.prototype.fmap=function(a){var b=this;return this.apply(function(){return a(b.value())})},b.prototype.apply=function(a){return new b(a)},b.prototype.filter=function(a){return a(this.value())},b.prototype.toString=function(){return this.value()},b}(h),j=function(a){function b(){return _=b.__super__.constructor.apply(this,arguments)}return db(b,a),b.prototype.isInitial=function(){return!0},b.prototype.isNext=function(){return!1},b.prototype.apply=function(a){return new b(a)},b.prototype.toNext=function(){return new k(this.value)},b}(k),f=function(a){function b(){return ab=b.__super__.constructor.apply(this,arguments)}return db(b,a),b.prototype.isEnd=function(){return!0},b.prototype.fmap=function(){return this},b.prototype.apply=function(){return this},b.prototype.toString=function(){return"<end>"},b}(h),g=function(a){function b(a){this.error=a}return db(b,a),b.prototype.isError=function(){return!0},b.prototype.fmap=function(){return this},b.prototype.apply=function(){return this},b.prototype.toString=function(){return"<error> "+this.error},b}(h),X=function(){var a,b,c;return a=2<=arguments.length?bb.call(arguments,0,c=arguments.length-1):(c=0,[]),b=arguments[c++],a=w.apply(null,a),b.deps=a.deps,b.toString=a.toString,b},m=function(){function b(a){this.combine=eb(this.combine,this),this.flatMapLatest=eb(this.flatMapLatest,this),this.fold=eb(this.fold,this),this.scan=eb(this.scan,this),a=w(a),this.assign=this.onValue,this.deps=a.deps,this.toString=a.toString}return b.prototype.onValue=function(){var a;return a=I(arguments),this.subscribe(function(b){return b.hasValue()?a(b.value()):void 0})},b.prototype.onValues=function(a){return this.onValue(function(b){return a.apply(null,b)})},b.prototype.onError=function(){var a;return a=I(arguments),this.subscribe(function(b){return b.isError()?a(b.error):void 0})},b.prototype.onEnd=function(){var a;return a=I(arguments),this.subscribe(function(b){return b.isEnd()?a():void 0})},b.prototype.errors=function(){return this.filter(function(){return!1})},b.prototype.filter=function(){var b,c;return c=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],v(this,c,b,function(b){return this.withHandler(w("filter",this,b),function(c){return c.filter(b)?this.push(c):a.more})})},b.prototype.takeWhile=function(){var b,c;return c=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],v(this,c,b,function(b){return this.withHandler(w("takeWhile",this,b),function(c){return c.filter(b)?this.push(c):(this.push(x()),a.noMore)})})},b.prototype.endOnError=function(){var a,b;return b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],null==b&&(b=!0),v(this,b,a,function(a){return this.withHandler(w("endOnError",this),function(b){return b.isError()&&a(b.error)?(this.push(b),this.push(x())):this.push(b)})})},b.prototype.take=function(b){return 0>=b?a.never():this.withHandler(w("take",this,b),function(c){return c.hasValue()?(b--,b>0?this.push(c):(0===b&&this.push(c),this.push(x()),a.noMore)):this.push(c)})},b.prototype.map=function(){var a,b;return b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],b instanceof n?b.sampledBy(this,y):v(this,b,a,function(a){return this.withHandler(w("map",this,a),function(b){return this.push(b.fmap(a))})})},b.prototype.mapError=function(){var a;return a=I(arguments),this.withHandler(w("mapError",this,a),function(b){return b.isError()?this.push(L(a(b.error))):this.push(b)})},b.prototype.mapEnd=function(){var b;return b=I(arguments),this.withHandler(w("mapEnd",this,b),function(c){return c.isEnd()?(this.push(L(b(c))),this.push(x()),a.noMore):this.push(c)})},b.prototype.doAction=function(){var a;return a=I(arguments),this.withHandler(w("doAction",this,a),function(b){return b.hasValue()&&a(b.value()),this.push(b)})},b.prototype.skip=function(b){return this.withHandler(w("skip",this,b),function(c){return c.hasValue()?b>0?(b--,a.more):this.push(c):this.push(c)})},b.prototype.skipDuplicates=function(a){return null==a&&(a=function(a,b){return a===b}),X("skipDuplicates",this,this.withStateMachine(l,function(b,c){return c.hasValue()?c.isInitial()||b===l||!a(b.get(),c.value())?[new q(c.value()),[c]]:[b,[]]:[b,[c]]}))},b.prototype.skipErrors=function(){return this.withHandler("skipErrors",function(b){return b.isError()?a.more:this.push(b)})},b.prototype.withStateMachine=function(b,c){var d;return d=b,this.withHandler(w("withStateMachine",this,b,c),function(b){var e,f,g,h,i,j,k;for(e=c(d,b),f=e[0],h=e[1],d=f,i=a.more,j=0,k=h.length;k>j;j++)if(g=h[j],i=this.push(g),i===a.noMore)return i;return i})},b.prototype.scan=function(b,c,d,e){var f,g,h,i=this;return g=R(c),c=d?g:function(a,b){return g(a(),b())},f=V(b).map(function(a){return Z.always(a)}),h=function(b){var d,e,g,h;return d=!1,h=M,e=a.more,g=function(){return d?void 0:(d=!0,f.forEach(function(c){return e=b(new j(c)),e===a.noMore?(h(),h=M):void 0}))},h=i.subscribe(function(h){var i,j;return h.hasValue()?d&&h.isInitial()?a.more:(h.isInitial()||g(),d=!0,j=f.getOrElse(function(){return void 0}),i=Z.cached(function(){return c(j,h.value)}),f=new q(i),b(h.apply(i))):(h.isEnd()&&(e=g()),e!==a.noMore?b(h):void 0)}),g(),h},new n(w(e||"scan",this,b,c),h)},b.prototype.fold=function(a,b){return X("fold",this,a,b,this.scan(a,b).sampledBy(this.filter(!1).mapEnd().toProperty()))},b.prototype.zip=function(b,c){return null==c&&(c=Array),a.zipWith([this,b],c)},b.prototype.diff=function(a,b){return b=R(b),this.scan([a],function(a,c){return[c,b(a[0],c)]}).filter(function(a){return 2===a.length}).map(function(a){return a[1]})},b.prototype.flatMap=function(b,d){var e;return b=K(b),e=this,new i(w("flatMap"+(d?"First":""),e,b),function(f){var g,h;return h=new c,g=function(a){return a(),h.empty()?f(x()):void 0},h.add(function(c,i){return e.subscribe(function(c){var e;return c.isEnd()?g(i):c.isError()?f(c):d&&h.count()>1?a.more:h.unsubscribed?a.noMore:(e=b(c.value()),E(e)||(e=a.once(e)),h.add(function(b,c){return e.subscribe(function(d){var e;return d.isEnd()?(g(c),a.noMore):(d instanceof j&&(d=d.toNext()),e=f(d),e===a.noMore&&b(),e)})}))})}),h.unsubscribe})},b.prototype.flatMapFirst=function(a){return this.flatMap(a,!0)},b.prototype.flatMapLatest=function(a){var b;return a=K(a),b=this.toEventStream(),X("flatMapLatest",this,a,b.flatMap(function(c){return a(c).takeUntil(b)}))},b.prototype.not=function(){return this.map(function(a){return!a})},b.prototype.log=function(){var a;return a=1<=arguments.length?bb.call(arguments,0):[],this.subscribe(function(b){return"undefined"!=typeof console&&null!==console?"function"==typeof console.log?console.log.apply(console,bb.call(a).concat([b.toString()])):void 0:void 0}),this},b.prototype.slidingWindow=function(a,b){return null==b&&(b=0),X("slidingWindow",this,a,b,this.scan([],function(b,c){return b.concat([c]).slice(-a)}).filter(function(a){return a.length>=b}))},b.prototype.combine=function(b,c){var d;return d=R(c),a.combineAsArray(this,b).map(function(a){return d(a[0],a[1])})},b.prototype.decode=function(b){return this.combine(a.combineTemplate(b),function(a,b){return b[a]})},b.prototype.awaiting=function(a){return X("awaiting",this,a,this.toEventStream().map(!0).merge(a.toEventStream().map(!1)).toProperty(!1))},b}(),m.prototype.reduce=m.prototype.fold,i=function(b){function c(a,b){this.takeUntil=eb(this.takeUntil,this),this.sampledBy=eb(this.sampledBy,this);var d;D(a)&&(b=a,a=[]),c.__super__.constructor.call(this,a),d=new e(b),this.subscribe=d.subscribe,this.subscribeInternal=this.subscribe,this.hasSubscribers=d.hasSubscribers,O(this)}return db(c,b),c.prototype.delay=function(b){return X("delay",this,b,this.flatMap(function(c){return a.later(b,c)}))},c.prototype.debounce=function(b){return X("debounce",this,b,this.flatMapLatest(function(c){return a.later(b,c)}))},c.prototype.debounceImmediate=function(b){return X("debounceImmediate",this,b,this.flatMapFirst(function(c){return a.once(c).concat(a.later(b).filter(!1))}))},c.prototype.throttle=function(a){return X("throttle",this,a,this.bufferWithTime(a).map(function(a){return a[a.length-1]}))},c.prototype.bufferWithTime=function(a){return X("bufferWithTime",this,a,this.bufferWithTimeOrCount(a,Number.MAX_VALUE))},c.prototype.bufferWithCount=function(a){return X("bufferWithCount",this,a,this.bufferWithTimeOrCount(void 0,a))},c.prototype.bufferWithTimeOrCount=function(a,b){var c;return c=function(c){return c.values.length===b?c.flush():void 0!==a?c.schedule():void 0},X("bufferWithTimeOrCount",this,a,b,this.buffer(a,c,c))},c.prototype.buffer=function(b,c,d){var e,f,g;return null==c&&(c=function(){}),null==d&&(d=function(){}),e={scheduled:!1,end:null,values:[],flush:function(){var b;if(this.scheduled=!1,this.values.length>0){if(b=this.push(L(this.values)),this.values=[],null!=this.end)return this.push(this.end);if(b!==a.noMore)return d(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){var a=this;return this.scheduled?void 0:(this.scheduled=!0,b(function(){return a.flush()}))}},g=a.more,D(b)||(f=b,b=function(b){return a.scheduler.setTimeout(b,f)}),this.withHandler("buffer",function(a){return e.push=this.push,a.isError()?g=this.push(a):a.isEnd()?(e.end=a,e.scheduled||e.flush()):(e.values.push(a.value()),c(e)),g})},c.prototype.merge=function(b){var d;return d=this,new c(w("merge",d,b),function(c){var e,f;return e=0,f=function(b){return function(d){return b.subscribe(function(b){var f;return b.isEnd()?(e++,2===e?c(x()):a.more):(f=c(b),f===a.noMore&&d(),f)})}},u(f(d),f(b))})},c.prototype.toProperty=function(a){return 0===arguments.length&&(a=l),this.scan(a,F,!0,w("toProperty",this,a))},c.prototype.toEventStream=function(){return this},c.prototype.sampledBy=function(a,b){return this.toProperty().sampledBy(a,b)},c.prototype.concat=function(a){var b;return b=this,new c(w("concat",b,a),function(c){var d;return d=b.subscribe(function(b){return b.isEnd()?d=a.subscribe(c):c(b)}),function(){return d()}})},c.prototype.takeUntil=function(b){var d;return d=this,new c(w("takeUntil",d,b),function(c){var e,f;return f=function(d){return b.onValue(function(){return c(x()),d(),a.noMore})},e=function(b){return d.subscribe(function(d){var e;return e=c(d),(d.isEnd()||e===a.noMore)&&b(),e})},u(f,e)})},c.prototype.skipUntil=function(a){var b;return b=a.take(1).map(!0).toProperty(!1),X("skipUntil",this,a,this.filter(b))},c.prototype.skipWhile=function(){var b,c,d;return c=arguments[0],b=2<=arguments.length?bb.call(arguments,1):[],d=!1,v(this,c,b,function(b){return this.withHandler(w("skipWhile",this,b),function(c){return!d&&c.hasValue()&&b(c.value())?a.more:(c.hasValue()&&(d=!0),this.push(c))})})},c.prototype.startWith=function(b){return a.once(b).concat(this)},c.prototype.withHandler=function(a,b){var d;return null==b&&(b=a,a=w("withHandler",this,b)),d=new e(this.subscribe,b),new c(w(a),d.subscribe)},c}(m),n=function(b){function c(b,d,e){this.toEventStream=eb(this.toEventStream,this),this.toProperty=eb(this.toProperty,this),this.changes=eb(this.changes,this),this.sample=eb(this.sample,this);var f=this;D(b)&&(e=d,d=b,b=[]),c.__super__.constructor.call(this,b),this.subscribeInternal=e===!0?d:new o(d,e).subscribe,this.sampledBy=function(b,d){var e,g,h,i;return null!=d?d=R(d):(e=!0,d=function(a){return a()}),i=new r(f,!1,!1,f.subscribeInternal,e),g=new r(b,!0,!1,b.subscribe,e),h=a.when([i,g],d,w("sampledBy",f,b,d)),b instanceof c?h.toProperty():h},this.subscribe=function(b){var c,d,e,g,h;return e=a.more,c=function(){function c(){}return c.prototype.set=function(a){return this.event=a},c.prototype.send=function(){var c;return c=this.event,this.event=null,null!=c&&e!==a.noMore&&(e=b(c),e===a.noMore)?g():void 0},c}(),h=new c,d=new c,g=M,g=f.subscribeInternal(function(c){return c.isError()?e!==a.noMore&&(e=b(c)):(c.hasValue()?h.set(c):c.isEnd()&&d.set(c),p.onDone(function(){return h.send(),d.send()})),e}),function(){return e=a.noMore,g()}},O(this)}return db(c,b),c.prototype.sample=function(b){return this.sampledBy(a.interval(b,{}))},c.prototype.changes=function(){var a=this;return new i(w("changes",this),function(b){return a.subscribe(function(a){return a.isInitial()?void 0:b(a)})})},c.prototype.withHandler=function(a,b){return null==b&&(b=a,a=w("withHandler",this,b)),new c(w(a),this.subscribeInternal,b)},c.prototype.toProperty=function(){return this},c.prototype.toEventStream=function(){var a=this;return new i(w("toEventStream",this),function(b){return a.subscribe(function(a){return a.isInitial()&&(a=a.toNext()),b(a)})})},c.prototype.and=function(a){return this.combine(a,function(a,b){return a&&b})},c.prototype.or=function(a){return this.combine(a,function(a,b){return a||b})},c.prototype.delay=function(a){return this.delayChanges(function(b){return b.delay(a)})},c.prototype.debounce=function(a){return this.delayChanges(function(b){return b.debounce(a)})},c.prototype.throttle=function(a){return this.delayChanges(function(b){return b.throttle(a)})},c.prototype.delayChanges=function(a){return s(this,a(this.changes()))},c.prototype.takeUntil=function(a){var b;return b=this.changes().takeUntil(a),s(this,b)},c.prototype.startWith=function(a){return this.scan(a,function(a,b){return b})},c}(m),v=function(a,b,c,d){var e;return b instanceof n?(e=b.sampledBy(a,function(a,b){return[a,b]}),d.apply(e,[function(a){var b,c;return b=a[0],c=a[1],b}]).map(function(a){var b,c;return b=a[0],c=a[1]})):(b=H(b,c),d.apply(a,[b]))},s=function(b,c){var d;return d=function(b){var c;return c=l,b.subscribe(function(b){return b.hasValue()&&(c=new q(b.value())),a.noMore}),c},c.toProperty(d(b))},e=function(){function b(b,c){var d,e,f,g,h,i,j,k,l,m=this;null==b&&(b=function(){return M}),j=[],h=null,g=!1,e=!1,this.hasSubscribers=function(){return j.length>0},f=null,k=M,i=function(a){return j=Z.without(a,j)},l=null,d=function(){var a,b,c,d,e;if(null!=l){for(b=l,l=null,e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a());return e}},this.push=function(b){var c,e,k,l,n,o;if(g)return h=(h||[]).concat([b]),a.more;if(b!==f){b.isError()&&(f=b),k=!1;try{for(g=!0,l=j,n=0,o=l.length;o>n;n++)e=l[n],c=e.sink(b),(c===a.noMore||b.isEnd())&&i(e);k=!0}finally{g=!1,k||(h=null)}for(k=!0;null!=h?h.length:void 0;)b=Z.head(h),h=Z.tail(h),m.push(b);return d(b),m.hasSubscribers()?a.more:a.noMore}},null==c&&(c=function(a){return this.push(a)}),this.handleEvent=function(a){return a.isEnd()&&(e=!0),c.apply(m,[a])},this.subscribe=function(a){var c;return e?(a(x()),M):(c={sink:a},j=j.concat(c),1===j.length&&(k=b(m.handleEvent)),function(){return i(c),m.hasSubscribers()?void 0:k()})}}return b}(),o=function(b){function c(b,d){var e,f,g,h=this;c.__super__.constructor.call(this,b,d),e=l,g=this.push,b=this.subscribe,f=!1,this.push=function(a){return a.isEnd()&&(f=!0),a.hasValue()&&(e=new q(a.value)),p.inTransaction(function(){return g.apply(h,[a])})},this.subscribe=function(c){var d,g,i;return d=!1,i=function(){return h.hasSubscribers()||f},g=e.filter(i).map(function(a){return c(A(a()))}),g.getOrElse(a.more)===a.noMore?M:f?(c(x()),M):b.apply(h,[c])}}return db(c,b),c}(e),p=function(){var a,b,c,d;return d=[],c=!1,b=function(a){return c?d.push(a):a()},a=function(a){var b,e,f,g,h;if(c)return a();c=!0;try{f=a()}finally{c=!1}for(e=d,d=[],g=0,h=e.length;h>g;g++)b=e[g],b();return f},{onDone:b,inTransaction:a}}(),b=function(b){function c(){var b,d,e,f,h,i,j,k;e=void 0,i=[],b=!1,d=function(b){return function(c){return c.isEnd()?(k(b),a.noMore):e(c)}},j=function(){var a,b,c,d;for(d=[],b=0,c=i.length;c>b;b++)a=i[b],d.push("function"==typeof a.unsub?a.unsub():void 0);return d},h=function(a){return a.unsub=a.input.subscribe(d(a.input))},k=function(a){var b,c,d,e;for(b=d=0,e=i.length;e>d;b=++d)if(c=i[b],c.input===a)return"function"==typeof c.unsub&&c.unsub(),i.splice(b,1),void 0},f=function(a){var b,c,d,f;for(e=a,f=t(i),c=0,d=f.length;d>c;c++)b=f[c],h(b);return j},c.__super__.constructor.call(this,f),this.plug=function(a){var c;if(!b)return c={input:a},i.push(c),null!=e&&h(c),function(){return k(a)}},this.push=function(a){return"function"==typeof e?e(L(a)):void 0},this.error=function(a){return"function"==typeof e?e(new g(a)):void 0},this.end=function(){return b=!0,j(),"function"==typeof e?e(x()):void 0}}return db(c,b),c}(i),r=function(){function a(a,b,c,d,e){var f,g;this.obs=a,this.sync=b,this.subscribe=d,null==e&&(e=!1),g=[],f=e?Z.id:function(a){return a()},null==this.subscribe&&(this.subscribe=a.subscribe),this.markEnded=function(){return this.ended=!0},c?(this.consume=function(){return f(g.shift())},this.push=function(a){return g.push(a)},this.mayHave=function(a){return!this.ended||g.length>=a},this.hasAtLeast=function(a){return g.length>=a}):(this.consume=function(){return f(g[0])},this.push=function(a){return g=[a]},this.mayHave=function(){return!0},this.hasAtLeast=function(){return g.length})}return a}(),r.fromObservable=function(a){return a instanceof r?a:a instanceof n?new r(a,!1,!1):new r(a,!0,!0)},w=function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],b instanceof d?b:(c=function(a){return B(a)?Z.flatMap(c,a):E(a)?[a]:[]},new d(c(a),function(){return Z.toString(b)+"("+Z.map(Z.toString,a)+")"}))},d=function(){function a(a,b){this.deps=a,this.toString=b}return a}(),a.when=function(){var b,c,e,f,g,h,j,k,l,m,n,o,p,q,s,t,v,y,A;if(n=1<=arguments.length?bb.call(arguments,0):[],0===n.length)return a.never();for(h=n.length,q="when: expecting arguments in the form (Observable+,function)+",b=Z.last(n),b instanceof d?(h-=1,n=n.slice(0,h)):b=w("when",n),p=[],m=[],e=0;h>e;){for(l=Z.toArray(n[e]),c=n[e+1],k={f:D(c)?c:function(){return c},ixs:[]},s=0,v=l.length;v>s;s++){for(o=l[s],f=z(p,o),0>f&&(p.push(o),f=p.length-1),A=k.ixs,t=0,y=A.length;y>t;t++)g=A[t],g.index===f&&g.count++;k.ixs.push({index:f,count:1})}l.length>0&&m.push(k),e+=2}return p.length?(p=Z.map(r.fromObservable,p),j=Z.map(function(a){return a.obs},p),new i(b,function(b){var c,d,f,g;return f=function(a){return Z.all(a.ixs,function(a){return p[a.index].hasAtLeast(a.count)})},d=function(a){return!a.sync||a.ended},c=function(a){return Z.any(a.ixs,function(a){return!p[a.index].mayHave(a.count)})},g=function(g){return function(h){return g.subscribe(function(i){var j,k,l,n,o;if(i.isEnd())g.markEnded(),(Z.all(p,d)||Z.all(m,c))&&(k=a.noMore,b(x()));else if(i.isError())k=b(i);else if(g.push(i.value),g.sync)for(n=0,o=m.length;o>n;n++)if(j=m[n],f(j)){l=function(){return j.f.apply(j,function(){var a,b,c,d;for(c=j.ixs,d=[],a=0,b=c.length;b>a;a++)e=c[a],d.push(p[e.index].consume());return d}())},k=b(i.apply(l));break}return k===a.noMore&&h(),k||a.more})}},u.apply(null,function(){var a,b,c;for(c=[],e=a=0,b=p.length;b>a;e=++a)o=p[e],c.push(g(o,e));return c}())})):a.never()},a.update=function(){var b,c,d,e;for(c=arguments[0],e=2<=arguments.length?bb.call(arguments,1):[],d=function(a){return function(){var b;return b=1<=arguments.length?bb.call(arguments,0):[],function(c){return a.apply(null,[c].concat(b))}}},b=e.length-1;b>0;)e[b]instanceof Function||(e[b]=function(a){return function(){return a}}(e[b])),e[b]=d(e[b]),b-=2;return a.when.apply(a,bb.call(e).concat([w("update",c,e)])).scan(c,function(a,b){return b(a)})},u=function(){var a;return a=1<=arguments.length?bb.call(arguments,0):[],new c(a).unsubscribe},c=function(){function a(a){var b,c,d;for(null==a&&(a=[]),this.empty=eb(this.empty,this),this.count=eb(this.count,this),this.unsubscribe=eb(this.unsubscribe,this),this.add=eb(this.add,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[],c=0,d=a.length;d>c;c++)b=a[c],this.add(b)}return a.prototype.add=function(a){var b,c,d,e=this;if(!this.unsubscribed)return b=!1,c=M,this.starting.push(a),d=function(){return e.unsubscribed?void 0:(c(),b=!0,e.remove(c),Z.remove(a,e.starting))},c=a(this.unsubscribe,d),this.unsubscribed||b||this.subscriptions.push(c),Z.remove(a,this.starting),c},a.prototype.remove=function(a){return this.unsubscribed?void 0:Z.remove(a,this.subscriptions)},a.prototype.unsubscribe=function(){var a,b,c,d;if(!this.unsubscribed){for(this.unsubscribed=!0,d=this.subscriptions,b=0,c=d.length;c>b;b++)a=d[b],a();return this.subscriptions=[],this.starting=[]}},a.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},a.prototype.empty=function(){return 0===this.count()},a}(),a.CompositeUnsubscribe=c,q=function(){function a(a){this.value=a}return a.prototype.getOrElse=function(){return this.value},a.prototype.get=function(){return this.value},a.prototype.filter=function(b){return b(this.value)?new a(this.value):l},a.prototype.map=function(b){return new a(b(this.value))},a.prototype.forEach=function(a){return a(this.value)},a.prototype.isDefined=!0,a.prototype.toArray=function(){return[this.value]},a}(),l={getOrElse:function(a){return a},filter:function(){return l},map:function(){return l},forEach:function(){},isDefined:!1,toArray:function(){return[]}},a.EventStream=i,a.Property=n,a.Observable=m,a.Bus=b,a.Initial=j,a.Next=k,a.End=f,a.Error=g,M=function(){},F=function(a,b){return b()},y=function(a){return a},A=function(a){return new j(Z.always(a))},L=function(a){return new k(Z.always(a))},x=function(){return new f},S=function(a){return a instanceof h?a:L(a)},t=function(a){return a.slice(0)},z=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],b===d)return c;return-1},D=function(a){return"function"==typeof a},B=function(a){return a instanceof Array},E=function(a){return a instanceof m},N=function(a,b){return function(){var c;return c=1<=arguments.length?bb.call(arguments,0):[],a.apply(null,b.concat(c))}},K=function(a){return E(a)&&(a=Z.always(a)),a},I=function(a){return a=Array.prototype.slice.call(a),J.apply(null,a)},J=Y(function(){var a,b;return b=arguments[0],a=2<=arguments.length?bb.call(arguments,1):[],D(b)?a.length?N(b,a):b:C(b)?T(b,a):Z.always(b)}),H=function(a,b){return J.apply(null,[a].concat(bb.call(b)))},C=function(a){return"string"==typeof a&&a.length>1&&"."===a.charAt(0)},a.isFieldKey=C,T=function(a,b){var c,d;return d=a.slice(1).split("."),c=Z.map(W(b),d),function(b){var d,e;for(d=0,e=c.length;e>d;d++)a=c[d],b=a(b);return b}},W=function(a){return function(b){return function(c){var d;return null==c?void 0:(d=c[b],D(d)?d.apply(c,a):d)}}},U=function(a){return a.slice(1)},R=function(a){var b;return D(a)?a:C(a)?(b=U(a),function(a,c){return a[b](c)}):void 0},V=function(a){return a instanceof q||a===l?a:new q(a)},Z={head:function(a){return a[0]},always:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},empty:function(a){return 0===a.length},tail:function(a){return a.slice(1,a.length)},filter:function(a,b){var c,d,e,f;for(c=[],e=0,f=b.length;f>e;e++)d=b[e],a(d)&&c.push(d);return c},map:function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(a(c));return f},each:function(a,b){var c,d,e;e=[];for(c in a)d=a[c],e.push(b(c,d));return e},toArray:function(a){return B(a)?a:[a]},contains:function(a,b){return-1!==z(a,b)},id:function(a){return a},last:function(a){return a[a.length-1]},all:function(a,b){var c,d,e;for(null==b&&(b=Z.id),d=0,e=a.length;e>d;d++)if(c=a[d],!b(c))return!1;return!0},any:function(a,b){var c,d,e;for(null==b&&(b=Z.id),d=0,e=a.length;e>d;d++)if(c=a[d],b(c))return!0;return!1},without:function(a,b){return Z.filter(function(b){return b!==a},b)},remove:function(a,b){var c;return c=z(b,a),c>=0?b.splice(c,1):void 0},fold:function(a,b,c){var d,e,f;for(e=0,f=a.length;f>e;e++)d=a[e],b=c(b,d);return b},flatMap:function(a,b){return Z.fold(b,[],function(b,c){return b.concat(a(c))})},cached:function(a){var b;return b=l,function(){return b===l&&(b=a(),a=null),b}},toString:function(a){return null==a?"undefined":D(a)?"function":B(a)?"["+Z.map(Z.toString,a).toString()+"]":(null!=a?a.toString():void 0)||a}},a._=Z,a.scheduler={setTimeout:function(a,b){return setTimeout(a,b)},setInterval:function(a,b){return setInterval(a,b)},clearInterval:function(a){return clearInterval(a)},now:function(){return(new Date).getTime()}},"undefined"!=typeof module&&null!==module?(module.exports=a,a.Bacon=a):("undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return a}),this.Bacon=a)}.call(this);