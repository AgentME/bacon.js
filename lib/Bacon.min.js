((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=this,E=Object.prototype.hasOwnProperty,F=function(a,b){function d(){this.constructor=a}for(var c in b)E.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},G=function(a,b){return function(){return a.apply(b,arguments)}};(C=this.jQuery||this.Zepto)!=null&&(C.fn.asEventStream=function(b){var c;return c=this,new g(function(d){var e,f;return e=function(b){var c;c=d(w(b));if(c===a.noMore)return f()},f=function(){return c.unbind(b,e)},c.bind(b,e),f})}),a=this.Bacon={taste:"delicious"},a.noMore="veggies",a.more="moar bacon!",a.never=function(){return new g(function(a){return function(){return x}})},a.later=function(b,c){return a.sequentially(b,[c])},a.sequentially=function(b,c){return a.repeatedly(b,c).take(p(function(a){return a.hasValue()},v(B,c)).length)},a.repeatedly=function(b,c){var d,e;return d=-1,e=function(){return d++,B(c[d%c.length])},a.fromPoll(b,e)},a.fromPoll=function(b,c){return new g(function(d){var e,f,g;return f=void 0,e=function(){var b,e;e=c(),b=d(e);if(b===a.noMore||e.isEnd())return g()},g=function(){return clearInterval(f)},f=setInterval(e,b),g})},a.interval=function(b,c){var d;return c==null&&(c={}),d=function(){return w(c)},a.fromPoll(b,d)},a.constant=function(a){return new k(function(b){return b(s(a)),b(o()),x})},a.combineAll=function(a,b){var c,d,e,f,g;d=r(a),g=z(a);for(e=0,f=g.length;e<f;e++)c=g[e],d=b(d,c);return d},a.mergeAll=function(b){return a.combineAll(b,function(a,b){return a.merge(b)})},a.combineAsArray=function(b){var c,d;return d=function(a){return a!=null?a instanceof Array?a:[a]:[]},c=function(a,b){return d(a).concat(d(b))},a.combineAll(b,function(a,b){return a.toProperty().combine(b,c)})},a.latestValue=function(a){var b,c=this;return b=void 0,a.subscribe(function(a){if(a.hasValue())return b=a.value}),function(){return b}},f=function(){function a(){}return a.prototype.isEvent=function(){return!0},a.prototype.isEnd=function(){return!1},a.prototype.isInitial=function(){return!1},a.prototype.isNext=function(){return!1},a.prototype.isError=function(){return!1},a.prototype.hasValue=function(){return!1},a.prototype.filter=function(a){return!0},a}(),i=function(a){function b(a){this.value=a}return F(b,a),b.prototype.isNext=function(){return!0},b.prototype.hasValue=function(){return!0},b.prototype.fmap=function(a){return w(a(this.value))},b.prototype.apply=function(a){return w(a)},b.prototype.filter=function(a){return a(this.value)},b}(f),h=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.isInitial=function(){return!0},b.prototype.isNext=function(){return!1},b.prototype.fmap=function(a){return s(a(this.value))},b.prototype.apply=function(a){return s(a)},b}(i),d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return F(b,a),b.prototype.isEnd=function(){return!0},b.prototype.fmap=function(){return this},b.prototype.apply=function(){return this},b}(f),e=function(a){function b(a){this.error=a}return F(b,a),b.prototype.isError=function(){return!0},b.prototype.fmap=function(){return this},b.prototype.apply=function(){return this},b}(f),j=function(){function a(){}return a.prototype.onValue=function(a){return this.subscribe(function(b){if(b.hasValue())return a(b.value)})},a.prototype.onError=function(a){return this.subscribe(function(b){if(b.isError())return a(b.error)})},a.prototype.errors=function(){return this.filter(function(){return!1})},a}(),g=function(b){function d(a){this.takeUntil=G(this.takeUntil,this),this["switch"]=G(this["switch"],this);var b;b=new c(a),this.subscribe=b.subscribe,this.hasSubscribers=b.hasSubscribers}return F(d,b),d.prototype.filter=function(b){return this.withHandler(function(c){return c.filter(b)?this.push(c):a.more})},d.prototype.takeWhile=function(b){return this.withHandler(function(c){return c.filter(b)?this.push(c):(this.push(o()),a.noMore)})},d.prototype.take=function(b){return this.withHandler(function(c){return c.hasValue()?b===1?(this.push(c),this.push(o()),a.noMore):(b--,this.push(c)):this.push(c)})},d.prototype.skip=function(b){return this.withHandler(function(c){return c.hasValue()?b>0?(b--,a.more):this.push(c):this.push(c)})},d.prototype.map=function(a){return this.withHandler(function(b){return this.push(b.fmap(a))})},d.prototype.flatMap=function(b){var c;return c=this,new d(function(d){var e,f,g,h,i,j;return f=[],g=!1,j=function(){},i=function(){var a,b,c;j();for(b=0,c=f.length;b<c;b++)a=f[b],a();return f=[]},e=function(){if(g&&f.length===0)return d(o())},h=function(c){var h,j,k,l;return c.isEnd()?(g=!0,e()):c.isError()?d(c):(h=b(c.value),l=void 0,k=function(){return l!=null&&y(l,f),e()},j=function(b){var c;return b.isEnd()?(k(),a.noMore):(c=d(b),c===a.noMore&&i(),c)},l=h.subscribe(j),f.push(l))},j=c.subscribe(h),i})},d.prototype["switch"]=function(a){var b=this;return this.flatMap(function(c){return a(c).takeUntil(b)})},d.prototype.delay=function(b){return this.flatMap(function(c){return a.later(b,c)})},d.prototype.throttle=function(b){return this["switch"](function(c){return a.later(b,c)})},d.prototype.bufferWithTime=function(b){var c,d,e,f;return f=[],e=function(a){return f.push(a),f.length===1},d=function(){var a;return a=f,f=[],a},c=function(){return a.later(b).map(d)},this.filter(e).flatMap(c)},d.prototype.bufferWithCount=function(a){var b;return b=[],this.withHandler(function(c){var d,e=this;d=function(){return e.push(w(b)),b=[]};if(c.isError())return this.push(c);if(c.isEnd())return d(),this.push(c);b.push(c.value);if(b.length===a)return d()})},d.prototype.merge=function(b){var c;return c=this,new d(function(d){var e,f,g,h,i;return h=x,i=x,g=function(){return h(),i()},e=0,f=function(b){var c;return b.isEnd()?(e++,e===2?d(o()):a.more):(c=d(b),c===a.noMore&&g(),c)},h=c.subscribe(f),i=b.subscribe(f),g})},d.prototype.takeUntil=function(a){return new d(A(this,a))},d.prototype.toProperty=function(a){return this.scan(a,u)},d.prototype.scan=function(a,b){var d,e,f,g;return d=a,f=function(a){return a.hasValue()&&(d=b(d,a.value)),this.push(a.apply(d))},e=new c(this.subscribe,f),g=function(a){return d!=null&&a(s(d)),e.subscribe(a)},new k(g)},d.prototype.distinctUntilChanged=function(){return this.withStateMachine(void 0,function(a,b){return b.hasValue()?a!==b.value?[b.value,[b]]:[a,[]]:[a,[b]]})},d.prototype.withStateMachine=function(b,c){var d;return d=b,this.withHandler(function(b){var e,f,g,h,i,j,k;e=c(d,b),f=e[0],h=e[1],d=f,i=a.more;for(j=0,k=h.length;j<k;j++){g=h[j],i=this.push(g);if(i===a.noMore)return i}return i})},d.prototype.decorateWith=function(a,b){return b.sampledBy(this,function(b,c){var d;return d=m(c),d[a]=b,d})},d.prototype.end=function(b){return b==null&&(b="end"),this.withHandler(function(c){return c.isEnd()?(this.push(w(b)),this.push(o()),a.noMore):a.more})},d.prototype.withHandler=function(a){return(new c(this.subscribe,a)).toEventStream()},d.prototype.toString=function(){return"EventStream"},d}(j),k=function(b){function c(b){var d,e=this;this.subscribe=b,this.toProperty=G(this.toProperty,this),this.changes=G(this.changes,this),this.takeUntil=G(this.takeUntil,this),this.distinctUntilChanged=G(this.distinctUntilChanged,this),this.filter=G(this.filter,this),this.map=G(this.map,this),this.sample=G(this.sample,this),d=function(b,d,f){var g,h;return g=void 0,h=void 0,new c(function(c){var i,j,k,l,m,n,p,q,r;return q=x,r=x,p=function(){return q(),r()},k=!1,m=!1,i=function(){if(k&&m)return c(o())},j=function(b,d,e){return function(f){var j;return f.isEnd()?(b(),i(),a.noMore):f.isError()?(j=c(f),j===a.noMore&&p,j):(d(f.value),g!=null&&h!=null?(j=e(c,f,g,h),j===a.noMore&&p,j):a.more)}},l=j(function(){return k=!0},function(a){return g=a},d),n=j(function(){return m=!0},function(a){return h=a},f),q=e.subscribe(l),r=b.subscribe(n),p})},this.combine=function(a,b){var c;return c=function(a,c,d,e){return a(c.apply(b(d,e)))},d(a,c,c)},this.sampledBy=function(a,b){var c;return b==null&&(b=q),c=function(a,c,d,e){return a(c.apply(b(d,e)))},d(a,x,c).changes().takeUntil(a.end())}}return F(c,b),c.prototype.sample=function(b){return this.sampledBy(a.interval(b,{}))},c.prototype.map=function(a){var b=this;return new c(function(c){return b.subscribe(function(b){return c(b.fmap(a))})})},c.prototype.filter=function(b){var d,e=this;return d=void 0,new c(function(c){return e.subscribe(function(e){if(!e.filter(b))return e.isInitial()&&d!=null?c(s(d)):a.more;c(e);if(e.hasValue())return d=e.value})})},c.prototype.distinctUntilChanged=function(){var b=this;return new c(function(c){var d;return d=void 0,b.subscribe(function(b){return b.hasValue()?b.value===d?a.more:(d=b.value,c(b)):c(b)})})},c.prototype.takeUntil=function(a){return new c(A(this,a))},c.prototype.changes=function(){var a=this;return new g(function(b){return a.subscribe(function(a){if(!a.isInitial())return b(a)})})},c.prototype.toProperty=function(){return this},c}(j),c=function(){function b(b,c){var d,e,f,g=this;b==null&&(b=function(){return x}),e=[],this.hasSubscribers=function(){return e.length>0},f=x,d=function(a){return y(a,e)},this.push=function(b){var c,f,h,i,j;j=l(e);for(h=0,i=j.length;h<i;h++)f=j[h],c=f(b),(c===a.noMore||b.isEnd())&&d(f);return g.hasSubscribers()?a.more:a.noMore},c==null&&(c=function(a){return this.push(a)}),this.handleEvent=function(a){return c.apply(g,[a])},this.subscribe=function(a){return e.push(a),e.length===1&&(f=b(g.handleEvent)),function(){d(a);if(!g.hasSubscribers())return f()}}}return b.prototype.toEventStream=function(){return new g(this.subscribe)},b.prototype.toString=function(){return"Dispatcher"},b}(),b=function(b){function d(){var b,f,g,h,i,j,k,l,m=this;h=void 0,l=[],g=[],f=function(b){return function(c){return c.isEnd()?(y(b,g),a.noMore):h(c)}},k=function(){var a,b,c;for(b=0,c=l.length;b<c;b++)a=l[b],a();return l=[]},i=function(a){var b,c,d;h=a,l=[];for(c=0,d=g.length;c<d;c++)b=g[c],l.push(b.subscribe(f(b)));return k},b=new c(i),j=function(a){return b.subscribe(a)},d.__super__.constructor.call(this,j),this.plug=function(a){g.push(a);if(h!=null)return l.push(a.subscribe(f(a)))},this.push=function(a){if(h!=null)return h(w(a))},this.error=function(a){if(h!=null)return h(new e(a))},this.end=function(){return k(),h(o())}}return F(d,b),d}(g),a.EventStream=g,a.Property=k,a.Bus=b,a.Initial=h,a.Next=i,a.End=d,a.Error=e,A=function(b,c){return function(d){var e,f,g,h,i;return h=x,i=x,g=function(){return h(),i()},e=function(b){var c;return b.isEnd()&&i(),c=d(b),c===a.noMore&&i(),c},f=function(b){return b.isError()?a.more:b.isEnd()?a.noMore:(h(),d(o()),a.noMore)},h=b.subscribe(e),i=c.subscribe(f),g}},x=function(){},u=function(a,b){return b},q=function(a,b){return a},s=function(a){return new h(a)},w=function(a){return new i(a)},o=function(){return new d},t=function(a){return a!=null&&a.isEvent!=null&&a.isEvent()},B=function(a){return t(a)?a:w(a)},n=function(a){return a.length===0},r=function(a){return a[0]},z=function(a){return a.slice(1,a.length)},p=function(a,b){var c,d,e,f;c=[];for(e=0,f=b.length;e<f;e++)d=b[e],a(d)&&c.push(d);return c},v=function(a,b){var c,d,e,f;f=[];for(d=0,e=b.length;d<e;d++)c=b[d],f.push(a(c));return f},l=function(a){return a.slice(0)},m=function(a){var b,c,d;b={};for(c in a)d=a[c],b[c]=d;return b},y=function(a,b){var c;c=b.indexOf(a);if(c>=0)return b.splice(c,1)}})).call(this);